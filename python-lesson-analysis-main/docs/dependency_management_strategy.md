# 의존성 버전 관리 전략

이 문서는 Python Lesson Analysis 프로젝트의 의존성 버전 관리 전략을 설명합니다. 모든 의존성 관련 작업은 반드시 `.venv` 가상 환경 내에서 수행해야 합니다.

## 1. 가상 환경 사용 원칙

### 가상 환경 활성화 방법
- Linux/Mac: `source .venv/bin/activate`
- Windows: `.venv\Scripts\activate`

### 가상 환경 사용 이유
1. **환경 격리**: 프로젝트별 의존성 격리로 충돌 방지
2. **재현 가능성**: 동일한 환경 구성 보장
3. **버전 고정**: 특정 버전의 패키지 사용 보장
4. **안전한 실험**: 시스템 Python 환경에 영향 없이 패키지 테스트 가능

## 2. 의존성 파일 구조

프로젝트는 다음과 같은 의존성 파일 구조를 사용합니다:

- `requirements/base.txt`: 핵심 의존성
- `requirements/dev.txt`: 개발 환경 의존성
- `requirements/test.txt`: 테스트 환경 의존성
- `requirements/prod.txt`: 프로덕션 환경 의존성

## 3. 버전 지정 규칙 (PEP 440 준수)

### 버전 지정 방식
- **정확한 버전**: `==` (예: `numpy==2.0.2`)
- **최소 버전**: `>=` (예: `pandas>=2.0.0`)
- **호환 가능 버전**: `~=` (예: `requests~=2.32.0`)
- **버전 범위**: `>=1.0.0,<2.0.0` (예: `torch>=2.0.0,<3.0.0`)

### 버전 지정 원칙
1. **핵심 패키지**: 정확한 버전 지정 (`==`)
2. **안정적인 API를 가진 패키지**: 호환 가능 버전 지정 (`~=`)
3. **빠르게 발전하는 패키지**: 최소 버전 지정 (`>=`)
4. **메이저 버전 호환성 이슈가 있는 패키지**: 버전 범위 지정 (`>=1.0.0,<2.0.0`)

## 4. 의존성 우선순위

의존성 충돌 발생 시 다음 우선순위를 따릅니다:

1. 보안 관련 패키지
2. 핵심 기능 관련 패키지 (whisperx 등)
3. 데이터 처리 관련 패키지 (pandas, numpy 등)
4. 유틸리티 패키지

## 5. 호환성 매트릭스

주요 패키지 간 호환성 매트릭스입니다:

| 패키지 | 버전 | 호환 패키지 | 호환 버전 | 비호환 버전 | 비고 |
|-------|------|------------|----------|------------|------|
| whisperx | latest | torch | >=2.0.0,<3.0.0 | <2.0.0 | CUDA 호환성 주의 |
| torch | 2.7.0 | torchaudio | 2.7.0 | 다른 버전 | 버전 일치 필요 |
| spacy | 3.8.0 | en_core_web_sm | 3.8.0 | NumPy 2.0 호환 | 버전 일치 필요 |
| pandas | 2.2.3 | numpy | >=2.0.0 | <2.0.0 | - |

## 6. 의존성 업데이트 프로세스

### 업데이트 절차
1. 가상 환경 활성화
2. 현재 의존성 상태 백업: `pip freeze > requirements/backup_$(date +%Y%m%d).txt`
3. 업데이트할 패키지 선정 및 호환성 검토
4. 테스트 환경에서 업데이트 테스트: `pip install -U <package>==<version>`
5. 테스트 수행: `pytest`
6. 성공 시 requirements 파일 업데이트
7. 변경사항 문서화

### 주의사항
- 핵심 패키지 업데이트 시 반드시 전체 테스트 수행
- 메이저 버전 업데이트는 별도 브랜치에서 테스트 후 병합
- 의존성 그래프 변화 확인: `pip-dependency-graph`

## 7. 충돌 해결 가이드라인

### 충돌 감지
- `scripts/install_deps.py --check-conflicts` 명령으로 충돌 감지

### 충돌 해결 단계
1. 충돌 패키지 식별
2. 호환 가능한 공통 버전 찾기
3. 불가능한 경우, 우선순위에 따라 패키지 선택
4. 필요시 대체 패키지 검토
5. 해결책 문서화

## 8. 의존성 버전 검증 도구

프로젝트는 다음 도구를 제공합니다:

1. `scripts/install_deps.py`: 환경별 의존성 설치 및 충돌 감지
2. `scripts/check_deps.py`: 의존성 상태 검증 및 보고
3. `scripts/update_deps.py`: 의존성 안전 업데이트 지원

## 9. 버전 고정 정책

다음 패키지는 버전을 엄격하게 고정합니다:

- `whisperx` (latest stable)
- `torch==2.7.0`
- `torchaudio==2.7.0`
- `spacy==3.8.0`

## 10. 의존성 문제 보고

의존성 문제 발견 시 다음 정보를 포함하여 보고합니다:

1. 환경 정보: Python 버전, OS 정보
2. 발생한 오류 메시지
3. `pip freeze` 출력 결과
4. 재현 단계

## 11. 의존성 관리 책임

의존성 관리는 다음 원칙을 따릅니다:

1. 모든 개발자는 가상 환경 사용 필수
2. 의존성 추가/변경 시 팀 논의 후 진행
3. 정기적인 의존성 감사 수행
4. 보안 취약점 발견 시 즉시 업데이트
